<!DOCTYPE html>
<html>
<head>
  <title>Udacity Todos Goals</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"></script>
</head>
<body>
  <div>
    <h1>Todo list</h1>
    <input id ="todo" type="text" placeholder="Add todo">
    <button id="todo_btn">Add todo</button>
    <ul id="todos"></ul>
  </div>
  <div>
      <h1>Goal list</h1>
      <input id ="goal" type="text" placeholder="Add goal">
      <button id="goal_btn">Add goal</button>
      <ul id="goals"></ul>
    </div>
  
    <script type='text/javascript'>
    // Library code
    function generateId() {
      return Math.random().toString(36).substring(2) + (new Date()).getTime().toString(36);
    }

    const ADD_TODO = 'ADD_TODO';
    const REMOVE_TODO = 'REMOVE_TODO';
    const TOOGLE_TODO = 'TOOGLE_TODO';

    const ADD_GOAL = 'ADD_GOAL';
    const REMOVE_GOAL = 'REMOVE_GOAL';
    const TOOGLE_GOAL = 'TOOGLE_GOAL';

    // App code
    function todos(state = [], action) {
      if (action.type === ADD_TODO) {
        return state.concat([action.todo]);
      }

      if (action.type === REMOVE_TODO) {
        return state.filter(todo => todo.id !== action.id);
      }

      if (action.type === TOOGLE_TODO) {
        return state.map((todo) => {
          if (todo.id !== action.id) {
            return todo;
          }

          return Object.assign({}, todo, { complete: !todo.complete });
        });
      }

      return state;
    }

    function goals(state = [], action) {
      switch (action.type) {
        case ADD_GOAL:
          return state.concat([action.goal]);
        case REMOVE_GOAL:
          return state.filter(goal => goal.id !== action.id);
        case TOOGLE_GOAL:
          return state.map((goal) => {
            if (goal.id !== action.id) {
              return goal;
            }

            return Object.assign({}, goal, { complete: !goal.complete });
          });
        default:
          return state;
      }
    }

    const store = Redux.createStore(Redux.combineReducers({
      goals,
      todos
    }));

    store.subscribe(() => {
      const { goals, todos } = store.getState();

      document.getElementById('goals').innerHTML = '';
      document.getElementById('todos').innerHTML = '';

      goals.forEach(addGoalToDOM);
      todos.forEach(addTodoToDOM);
    })
    // store.subscribe(() => {
    //   console.log('The new state is ', store.getState());
    // });

    // store.dispatch({
    //   todo: {
    //     complete: false,
    //     id: 0,
    //     name: 'Learn Redux',
    //   },
    //   type: 'ADD_TODO',
    // });

    // store.dispatch({
    //   todo: {
    //     complete: true,
    //     id: 1,
    //     name: 'Read a book',
    //   },
    //   type: 'ADD_TODO',
    // });

    // const unsubscribe = store.subscribe(() => {
    //   console.log('The store changed');
    // });
    // unsubscribe();

    // DOM code
    function addTodo() {
      const input = document.getElementById('todo')
      const name = input.value
      input.value = ''
        store.dispatch({
          todo: {
            complete: false,
            id: generateId(),
            name,
          },
          type: 'ADD_TODO',
        });
      }

      function addGoal() {
        const input = document.getElementById('goal')
        const name = input.value
        input.value = ''
          store.dispatch({
            goal: {
              complete: false,
              id: generateId(),
              name,
            },
            type: 'ADD_GOAL',
          });
      }

      function toggleTodo(id) {
          store.dispatch({
            id: id,
            type: TOOGLE_TODO,
          });
      }

      function removeTodoAction(id) {
        return {
          id: id,
          type: REMOVE_TODO,
        }
      }

      function removeGoalAction(id) {
        return {
          id: id,
          type: REMOVE_GOAL,
        }
      }

      document.getElementById('todo_btn')
        .addEventListener('click', addTodo)

      document.getElementById('goal_btn')
        .addEventListener('click', addGoal)

      function createRemoveButton(onClick) {
        const removeButton = document.createElement('button');
        removeButton.innerHTML = 'X';
        removeButton.addEventListener('click', onClick)
        return removeButton;
      }

      function addTodoToDOM(todo) {
        const node = document.createElement('li');
        const text = document.createTextNode(todo.name);
        const removeButton = createRemoveButton(() => {
          store.dispatch(removeTodoAction(todo.id));
        });

        node.appendChild(text);
        node.appendChild(removeButton);
        node.style.textDecoration = todo.complete ? 'line-through' : 'none'
        node.addEventListener('click', () => {
          toggleTodo(todo.id);
        });
        document.getElementById('todos').appendChild(node);
      }

      function addGoalToDOM(goal) {
        const node = document.createElement('li');
        const text = document.createTextNode(goal.name);
        const removeButton = createRemoveButton(() => {
          store.dispatch(removeGoalAction(goal.id));
        });

        node.appendChild(text);
        node.appendChild(removeButton);
        document.getElementById('goals').appendChild(node);
      }
  </script>
</body>
</html>